<!DOCTYPE html>
<html>

<head>
    <title> Chit Chat </title>

    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>



    <style>

        #msgbox {
            margin-top:5px;
            width: 500px;
            height: 500px;
            overflow-y: scroll;
            overflow-x: wrap;
        }

        #message input {
            height: 50px;
            width: 400px;
        }

        #messages p{
            font-size: 20px;
        }

        #header{
            height:100px;
            background: #26c6da;
            color:#e0f7fa;  
            padding-top: 30px;
        }   
        
        #msgwell{
            background: #AB47BC;
            color: white;
        }

        #titlebar{
            height:40px;
            background: #1E88E5;
            color: white;
            padding-left: 10px;
        }

        #users{
            color:green;
            font-size: 14px;
            height:400px;
            overflow-y: scroll;
            padding: 5px;  
        }

        #usrnm{
            color: #FF7043  ;
        }

        #welcome{
            font-size: 20px;
            font-family: consolas;

        }

    </style>


</head>

<body>
    <div id="header">
        <h1 class="display-3"> ChitChat </h1>
    </div>

    <div class="container-fluid">
        <div id="login">
            <h3> Please provide an username to join the chat </h3>
            <hr>
            <form action="" id="loginform">
                <p>Username</p>
                <p><input id="username" autocomplete="off" /></p>
                <p><button id="signin" class="btn btn-primary"> Login </button></p>
            </form>
        </div>
        <div class="row">
            <div class="col-md-6" id="msgdiv">
                <div id="msgbox">
                    <div id="messages"></div>
                </div>

                <div id="message">
                    <form action="" id="msgform">
                        <p><input id="msg"  autocomplete="off" /></p>
                        <p><button id="msgbtn" class="btn btn-primary">Send</button></p>
                    </form>
                </div>
            </div>

            <div class="col-md-4" id="onlinediv">
                <span id="welcome"> </span>
                <div id="titlebar"> 
                    <h1> Online Users <span id="onlinecount" class="badge"> </span></h1>
                </div>
                <div class="list-group" id="users"> 
                </div>
            </div>
        </div>

    </div>

    <script>
        // hidden elemets will be reveled once the user signs in 
        $('#msgbox').hide();
        $('#message').hide();
        $('#onlinediv').hide();
        var socket = io();

        // once the user presses the button
        $('#signin').on('click touchstart', function(e) {
            e.preventDefault();
            // emit the user name to the server
            socket.emit('user', $('#username').val());
            $('#username').val('');
            return false;
        });

        // when the user selects to send the message
        $('#msgbtn').on('click touchstart', function(e) {
            e.preventDefault();
            // emit the message the user is sending 
            socket.emit('chat message', $('#msg').val());
            // clear the message variable once message has been sent
            $('#msg').val('');
            return false;
        });     

        socket.on('chat message', (data) => {
                //console.log(data.msg);
                var msgdiv = document.getElementById("messages");
                //console.log(socket);
                //$('#msgwell').css('background','red');
                msgdiv.innerHTML = msgdiv.innerHTML + '<div class="well well-sm" id="msgwell"><strong><span id="usrnm">' + data.user + '</span></strong>' + ' : ' +  data.msg + '</div>';
                $('#msgbox').scrollTop($('#msgbox')[0].scrollHeight);

                    
        });

        socket.on('message', (data) =>{
            console.log(data);
            var headDiv = document.getElementById('welcome');
            headDiv.innerHTML = 'Welcome, <b> '+ data + '</b>';
        });

        socket.on('users', (users) => {
            $('#login').hide();
            $('#msgbox').show();
            $('#message').show();
            $('#onlinediv').show();
            var div = document.getElementById('users');
            div.innerHTML = '';
            var str = users.users;
            console.log(str);
            for (var i = 0; i < str.length; i++) {
                var user = str[i].toString();
                //console.log(user);
                //$('#users').text(user);
                div.innerHTML = div.innerHTML + '<b>' + user + '<br>';
            }
            var onCount = document.getElementById('onlinecount');
            onCount.innerHTML = str.length;

        });





    </script>



</html>